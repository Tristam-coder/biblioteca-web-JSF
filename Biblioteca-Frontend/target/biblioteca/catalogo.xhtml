<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:b="http://bootsfaces.net/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="/template.xhtml">

    <ui:define name="title">Cat√°logo de Libros - Ediciones Saberum</ui:define>

    <ui:define name="content">
        <div class="container py-4">
            <div class="breadcrumb mb-4">
                <b:link value="Inicio" outcome="/index.xhtml"/>
                <span class="mx-2 text-muted">/</span>
                <span class="text-primary">Cat√°logo</span>
            </div>

            <h1 class="mb-4">Cat√°logo de Libros</h1>
            
            <b:panel title="B√∫squeda y Filtros" look="primary" class="mb-4">
                <h:form id="searchForm">
                    <b:row>
                        <b:column col-md="6">
                            <b:inputText value="#{catalogoController.searchTerm}" 
                                       placeholder="Buscar por t√≠tulo, autor o ISBN..."
                                       styleClass="w-100 mb-3"
                                       onkeyup="if(event.keyCode==13) document.getElementById('searchForm:searchBtn').click()"/>
                        </b:column>
                        <b:column col-md="3">
                            <b:selectOneMenu value="#{catalogoController.filtroIdioma}" styleClass="w-100 mb-3">
                                <f:selectItem itemValue="todos" itemLabel="Todos los idiomas"/>
                                <f:selectItem itemValue="Espa√±ol" itemLabel="Espa√±ol"/>
                                <f:selectItem itemValue="Ingl√©s" itemLabel="Ingl√©s"/>
                            </b:selectOneMenu>
                        </b:column>
                        <b:column col-md="3" class="d-flex align-items-end gap-2">
                            <b:commandButton id="searchBtn" value="üîç Buscar" 
                                           look="primary"
                                           action="#{catalogoController.buscar}"
                                           styleClass="flex-fill"/>
                            <b:commandButton value="üîÑ Limpiar" 
                                           look="secondary"
                                           action="#{catalogoController.limpiarBusqueda}"
                                           styleClass="flex-fill"/>
                        </b:column>
                    </b:row>
                </h:form>
            </b:panel>

            <h:form id="resultsForm">
                <div class="row">
                    <ui:repeat value="#{catalogoController.libros}" var="libro">
                        <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-4">
                            <div class="card book-card h-100 shadow-sm">
                                <div class="card-body d-flex flex-column text-center">
                                    <!-- ‚úÖ IMAGEN CON TAMA√ëO FIJO -->
                                    <h:graphicImage library="IMG" 
                                                  name="#{libro.titulo.contains('Rayuela') ? 'rayuela.jpeg' : libro.titulo.contains('1984') ? '1984.jpg' : libro.titulo.contains('Don Quijote') ? 'don_quijote.jpg' : libro.titulo.contains('La Casa') ? 'La_casa_es.jpg' : libro.titulo.contains('El T√∫nel') ? 'paramo.jpg' : libro.titulo.contains('Pedro P√°ramo') ? 'paramo.jpg' : 'cien_a√±os.jpg'}" 
                                                  styleClass="book-cover-small"/>

                                    <h6 class="card-title">#{libro.titulo}</h6>
                                    <p class="card-subtitle mb-2 text-muted small">#{libro.autor}</p>
                                    <p class="card-text small text-muted">ISBN: #{libro.isbn}</p>

                                    <div class="mt-auto">
                                        <span class="badge bg-success mb-2">Disponible</span>
                                        <div class="mt-2">
                                            <b:commandButton value="Ver Detalles" 
                                                          action="#{catalogoController.verDetalle(libro)}"
                                                          look="primary" 
                                                          size="sm"
                                                          styleClass="w-100"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ui:repeat>
                </div>

                <div class="text-center mt-4" rendered="#{empty catalogoController.libros}">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No se encontraron libros que coincidan con tu b√∫squeda.
                    </div>
                </div>
            </h:form>
        </div>
    </ui:define>
</ui:composition>