<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:b="http://bootsfaces.net/ui"
                template="/template.xhtml">

    <ui:define name="title">Iniciar SesiÃ³n - Ediciones Saberum</ui:define>

    <ui:define name="content">
        <div class="container py-4">
            <b:row styleClass="justify-content-center">
                <b:column col-lg="5" col-md="7">
                    
                    <!-- Mostrar mensaje de error si existe -->
                    <h:panelGroup rendered="#{param.error eq 'true'}">
                        <b:alert look="danger" show="true" styleClass="mb-4">
                            <strong>Error:</strong> Usuario o contraseÃ±a incorrectos.
                        </b:alert>
                    </h:panelGroup>

                    <!-- Mostrar mensaje de registro exitoso -->
                    <h:panelGroup rendered="#{param.registro eq 'exitoso'}">
                        <b:alert look="success" show="true" styleClass="mb-4">
                            <strong>Â¡Registro exitoso!</strong> Ya puedes iniciar sesiÃ³n con tus credenciales.
                        </b:alert>
                    </h:panelGroup>
                    
                    <b:panel title="Acceso al Sistema" look="success">
                        <h:form id="loginForm">
                            <b:inputText label="Usuario o Correo" 
                                       value="#{authController.username}"
                                       required="true"
                                       requiredMessage="El usuario o correo es obligatorio"
                                       styleClass="mb-3"/>
                            
                            <b:inputSecret label="ContraseÃ±a" 
                                         value="#{authController.password}"
                                         required="true"
                                         requiredMessage="La contraseÃ±a es obligatoria"
                                         styleClass="mb-3"/>
                            
                            <b:row>
                                <b:column>
                                    <b:selectBooleanCheckbox label="Recordar sesiÃ³n" 
                                                           value="#{authController.recordar}"
                                                           styleClass="mb-3"/>
                                </b:column>
                                <b:column class="text-end">
                                    <b:link value="Â¿OlvidÃ³ su contraseÃ±a?" 
                                            outcome="/recuperar-contrasena.xhtml"
                                            styleClass="small"/>
                                </b:column>
                            </b:row>
                            
                            <b:commandButton value="Iniciar SesiÃ³n" 
                                             look="success" 
                                             action="#{authController.login}"
                                             styleClass="w-100 mt-3 mb-2"
                                             id="loginBtn"/>
                            
                            <div class="text-center">
                                <span class="text-muted">Â¿No tiene cuenta? </span>
                                <b:link value="RegÃ­strese aquÃ­" 
                                        outcome="/registro.xhtml"/>
                            </div>
                        </h:form>
                    </b:panel>
                    
                    <!-- Login rÃ¡pido para demo -->
                    <div class="mt-4">
                        <b:panel title="Demo RÃ¡pido" look="info" collapsed="true">
                            <p class="small text-muted mb-3">Para propÃ³sitos de demostraciÃ³n:</p>
                            <div class="d-grid gap-2">
                                <b:button value="ðŸ‘¤ Usuario Normal" 
                                         look="outline-primary" 
                                         onclick="demoLogin('usuario', '123')"
                                         size="sm"/>
                                <b:button value="ðŸ‘¨â€ðŸ’¼ Administrador" 
                                         look="outline-success" 
                                         onclick="demoLogin('admin', 'admin')"
                                         size="sm"/>
                            </div>
                        </b:panel>
                    </div>
                </b:column>
            </b:row>
        </div>
        
        <script>
            function demoLogin(username, password) {
                document.querySelector('#loginForm\\:username').value = username;
                document.querySelector('#loginForm\\:password').value = password;
                
                setTimeout(function() {
                    document.querySelector('#loginForm\\:loginBtn').click();
                }, 100);
            }
        </script>
    </ui:define>
</ui:composition>