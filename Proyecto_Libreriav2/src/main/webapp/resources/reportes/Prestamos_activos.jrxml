<!-- Created with Jaspersoft Studio version 7.0.3.final using JasperReports Library version 7.0.3-41034ca841d452f3305ba55b9042260aaa1ab5dd  -->
<jasperReport name="prestamos_activos" language="java" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="e0067e54-7038-4073-a2e8-c6d992e48525">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="Libreria"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<style name="Title" fontSize="26.0" bold="true"/>
	<style name="SubTitle" forecolor="#666666" fontSize="12.0"/>
	<style name="ColumnHeader" forecolor="#FFFFFF" fontSize="10.0" bold="true"/>
	<style name="Detail" fontSize="9.0"/>
	<parameter name="FECHA_REPORTE" forPrompting="false" class="java.util.Date">
		<defaultValueExpression><![CDATA[new java.util.Date()]]></defaultValueExpression>
	</parameter>
	<query language="sql"><![CDATA[SELECT 
            p.id AS prestamo_id,
            u.nombre || ' ' || u.apellido AS nombre_usuario,
            u.dni,
            u.telefono,
            o.titulo AS titulo_obra,
            e.codigo_barras,
            p.fecha_prestamo,
            p.fecha_devolucion_prevista,
            (p.fecha_devolucion_prevista::date - CURRENT_DATE) AS dias_restantes,
            CASE 
                WHEN (p.fecha_devolucion_prevista::date - CURRENT_DATE) < 0 
                THEN 'VENCIDO'
                WHEN (p.fecha_devolucion_prevista::date - CURRENT_DATE) <= 2 
                THEN 'POR VENCER'
                ELSE 'VIGENTE'
            END AS situacion
        FROM public.prestamo p
        INNER JOIN public.usuario u ON p.usuario_id = u.id
        INNER JOIN public.ejemplar e ON p.ejemplar_id = e.id
        INNER JOIN public.obra o ON e.obra_id = o.id
        WHERE p.estado = 'ACTIVO'
        ORDER BY p.fecha_devolucion_prevista ASC, u.apellido ASC]]></query>
	<field name="prestamo_id" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="prestamo_id"/>
		<property name="com.jaspersoft.studio.field.label" value="prestamo_id"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="prestamo"/>
	</field>
	<field name="nombre_usuario" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="nombre_usuario"/>
		<property name="com.jaspersoft.studio.field.label" value="nombre_usuario"/>
	</field>
	<field name="dni" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="dni"/>
		<property name="com.jaspersoft.studio.field.label" value="dni"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="usuario"/>
	</field>
	<field name="telefono" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="telefono"/>
		<property name="com.jaspersoft.studio.field.label" value="telefono"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="usuario"/>
	</field>
	<field name="titulo_obra" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="titulo_obra"/>
		<property name="com.jaspersoft.studio.field.label" value="titulo_obra"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="obra"/>
	</field>
	<field name="codigo_barras" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="codigo_barras"/>
		<property name="com.jaspersoft.studio.field.label" value="codigo_barras"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="ejemplar"/>
	</field>
	<field name="fecha_prestamo" class="java.sql.Date">
		<property name="com.jaspersoft.studio.field.name" value="fecha_prestamo"/>
		<property name="com.jaspersoft.studio.field.label" value="fecha_prestamo"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="prestamo"/>
	</field>
	<field name="fecha_devolucion_prevista" class="java.sql.Date">
		<property name="com.jaspersoft.studio.field.name" value="fecha_devolucion_prevista"/>
		<property name="com.jaspersoft.studio.field.label" value="fecha_devolucion_prevista"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="prestamo"/>
	</field>
	<field name="dias_restantes" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="dias_restantes"/>
		<property name="com.jaspersoft.studio.field.label" value="dias_restantes"/>
	</field>
	<field name="situacion" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="situacion"/>
		<property name="com.jaspersoft.studio.field.label" value="situacion"/>
	</field>
	<variable name="total_prestamos" calculation="Count" class="java.lang.Integer">
		<expression><![CDATA[$F{prestamo_id}]]></expression>
	</variable>
	<variable name="prestamos_vencidos" calculation="Sum" class="java.lang.Integer">
		<expression><![CDATA[$F{situacion}.equals("VENCIDO") ? 1 : 0]]></expression>
	</variable>
	<background splitType="Stretch"/>
	<title height="100" splitType="Stretch">
		<element kind="staticText" uuid="677f5190-1beb-4f98-9070-9e57ec0557f5" x="0" y="10" width="555" height="40" fontName="Arial" fontSize="24.0" bold="true" hTextAlign="Center" vTextAlign="Middle" style="Title">
			<text><![CDATA[BIBLIOTECA SABERUM]]></text>
		</element>
		<element kind="staticText" uuid="9ecadebb-b44e-4467-863c-84890d0bec5b" x="0" y="50" width="555" height="25" fontName="Arial" fontSize="14.0" bold="true" hTextAlign="Center" vTextAlign="Middle" style="SubTitle">
			<text><![CDATA[Reporte de Préstamos Activos]]></text>
		</element>
		<element kind="textField" uuid="bf644b6f-f6b8-4b34-b71d-013e0d3e859e" x="430" y="75" width="125" height="20" forecolor="#666666" fontName="Arial" fontSize="9.0" pattern="dd/MM/yyyy HH:mm" hTextAlign="Right">
			<expression><![CDATA["Fecha: " + new java.text.SimpleDateFormat("dd/MM/yyyy HH:mm").format($P{FECHA_REPORTE})]]></expression>
		</element>
		<element kind="line" uuid="a8568b06-49d5-4e68-a1ab-2d17a1accf71" x="0" y="98" width="555" height="1" forecolor="#3366CC">
			<pen lineWidth="2.0"/>
		</element>
	</title>
	<columnHeader height="30" splitType="Stretch">
		<element kind="staticText" uuid="c7564ac6-0396-4112-bece-68818cf0090b" mode="Opaque" x="0" y="5" width="40" height="20" backcolor="#3366CC" fontName="Arial" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle" style="ColumnHeader">
			<text><![CDATA[ID]]></text>
			<box style="ColumnHeader">
				<pen lineWidth="0.5" lineColor="#FFFFFF"/>
			</box>
		</element>
		<element kind="staticText" uuid="24fcd13d-12ba-47e1-a9fc-da8f8573a629" mode="Opaque" x="40" y="5" width="95" height="20" backcolor="#3366CC" fontName="Arial" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle" style="ColumnHeader">
			<text><![CDATA[Usuario]]></text>
			<box style="ColumnHeader">
				<pen lineWidth="0.5" lineColor="#FFFFFF"/>
			</box>
		</element>
		<element kind="staticText" uuid="5f44632f-7f39-4e07-b02d-67f7c61d6d6c" mode="Opaque" x="135" y="5" width="140" height="20" backcolor="#3366CC" fontName="Arial" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle" style="ColumnHeader">
			<text><![CDATA[Obra]]></text>
			<box style="ColumnHeader">
				<pen lineWidth="0.5" lineColor="#FFFFFF"/>
			</box>
		</element>
		<element kind="staticText" uuid="7d6f162d-4ded-4afe-9a12-6f348a6d44b0" mode="Opaque" x="275" y="5" width="70" height="20" backcolor="#3366CC" fontName="Arial" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle" style="ColumnHeader">
			<text><![CDATA[Código Barras]]></text>
			<box style="ColumnHeader">
				<pen lineWidth="0.5" lineColor="#FFFFFF"/>
			</box>
		</element>
		<element kind="staticText" uuid="85ae9007-e915-4ec2-b3e8-bb89d38a26c0" mode="Opaque" x="345" y="5" width="60" height="20" backcolor="#3366CC" fontName="Arial" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle" style="ColumnHeader">
			<text><![CDATA[F. Préstamo]]></text>
			<box style="ColumnHeader">
				<pen lineWidth="0.5" lineColor="#FFFFFF"/>
			</box>
		</element>
		<element kind="staticText" uuid="a6ad5085-df2b-4c01-9014-01c324ebf6f2" mode="Opaque" x="405" y="5" width="60" height="20" backcolor="#3366CC" fontName="Arial" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle" style="ColumnHeader">
			<text><![CDATA[F. Devolución]]></text>
			<box style="ColumnHeader">
				<pen lineWidth="0.5" lineColor="#FFFFFF"/>
			</box>
		</element>
		<element kind="staticText" uuid="ed98a5ed-4932-43aa-a951-070202352498" mode="Opaque" x="465" y="5" width="90" height="20" backcolor="#3366CC" fontName="Arial" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle" style="ColumnHeader">
			<text><![CDATA[Situación]]></text>
			<box style="ColumnHeader">
				<pen lineWidth="0.5" lineColor="#FFFFFF"/>
			</box>
		</element>
	</columnHeader>
	<detail>
		<band height="25" splitType="Stretch">
			<element kind="textField" uuid="ae50f2e0-41f4-4110-90e3-93086bea61ab" x="0" y="2" width="40" height="20" backcolor="#F0F0F0" fontName="Arial" fontSize="8.0" hTextAlign="Center" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 == 0]]></printWhenExpression>
				<expression><![CDATA[$F{prestamo_id}]]></expression>
				<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="prestamo_id"/>
				<box style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="9a836851-c64d-4ece-bda0-ce259fb69cbb" x="0" y="2" width="40" height="20" fontName="Arial" fontSize="8.0" hTextAlign="Center" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 != 0]]></printWhenExpression>
				<expression><![CDATA[$F{prestamo_id}]]></expression>
				<box style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="2d4ab0e5-160a-4672-8641-3b9579ed2a89" x="40" y="2" width="95" height="20" backcolor="#F0F0F0" fontName="Arial" fontSize="8.0" textAdjust="StretchHeight" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 == 0]]></printWhenExpression>
				<expression><![CDATA[$F{nombre_usuario}]]></expression>
				<box leftPadding="3" style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="6323bd54-35fc-4676-b25c-aaa27899e2a4" x="40" y="2" width="95" height="20" fontName="Arial" fontSize="8.0" textAdjust="StretchHeight" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 != 0]]></printWhenExpression>
				<expression><![CDATA[$F{nombre_usuario}]]></expression>
				<box leftPadding="3" style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="dd5c130b-e8f8-4204-969b-fdd32045dbc4" x="135" y="2" width="140" height="20" backcolor="#F0F0F0" fontName="Arial" fontSize="8.0" textAdjust="StretchHeight" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 == 0]]></printWhenExpression>
				<expression><![CDATA[$F{titulo_obra}]]></expression>
				<box leftPadding="3" style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="bd3dc716-3383-4277-90ba-5609b3c54eb1" x="135" y="2" width="140" height="20" fontName="Arial" fontSize="8.0" textAdjust="StretchHeight" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 != 0]]></printWhenExpression>
				<expression><![CDATA[$F{titulo_obra}]]></expression>
				<box leftPadding="3" style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="150e9dd4-0232-41d2-a3cb-f5dac3400d9f" x="275" y="2" width="70" height="20" backcolor="#F0F0F0" fontName="Arial" fontSize="7.0" hTextAlign="Center" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 == 0]]></printWhenExpression>
				<expression><![CDATA[$F{codigo_barras}]]></expression>
				<box style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="e6464883-6ed9-4be2-a37b-3de6f88cfe5a" x="275" y="2" width="70" height="20" fontName="Arial" fontSize="7.0" hTextAlign="Center" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 != 0]]></printWhenExpression>
				<expression><![CDATA[$F{codigo_barras}]]></expression>
				<box style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="f1506e1c-9a1e-4ecf-8a50-113b8fda7cff" x="345" y="2" width="60" height="20" backcolor="#F0F0F0" fontName="Arial" fontSize="8.0" pattern="dd/MM/yyyy" hTextAlign="Center" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 == 0]]></printWhenExpression>
				<expression><![CDATA[$F{fecha_prestamo}]]></expression>
				<box style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="22db5d79-8fc2-4cb6-ac4a-fdcabaf32427" x="345" y="2" width="60" height="20" fontName="Arial" fontSize="8.0" pattern="dd/MM/yyyy" hTextAlign="Center" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 != 0]]></printWhenExpression>
				<expression><![CDATA[$F{fecha_prestamo}]]></expression>
				<box style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="fc5e22cc-7fc2-4332-8086-db5878efb9c9" x="405" y="2" width="60" height="20" backcolor="#F0F0F0" fontName="Arial" fontSize="8.0" pattern="dd/MM/yyyy" hTextAlign="Center" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 == 0]]></printWhenExpression>
				<expression><![CDATA[$F{fecha_devolucion_prevista}]]></expression>
				<box style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="8db169d5-9ea3-4a3a-8054-38f02e9be418" x="405" y="2" width="60" height="20" fontName="Arial" fontSize="8.0" pattern="dd/MM/yyyy" hTextAlign="Center" vTextAlign="Middle" style="Detail">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 != 0]]></printWhenExpression>
				<expression><![CDATA[$F{fecha_devolucion_prevista}]]></expression>
				<box style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
			<element kind="textField" uuid="55b5ae3f-98d5-4545-9751-992dce5f395a" x="465" y="2" width="90" height="20" fontName="Arial" fontSize="7.0" bold="true" hTextAlign="Center" vTextAlign="Middle" style="Detail">
				<expression><![CDATA[$F{situacion} + " (" + $F{dias_restantes} + " días)"]]></expression>
				<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="situacion"/>
				<box style="Detail">
					<pen lineWidth="0.25" lineColor="#CCCCCC"/>
				</box>
			</element>
		</band>
	</detail>
	<columnFooter height="5" splitType="Stretch"/>
	<pageFooter height="30" splitType="Stretch">
		<element kind="textField" uuid="4004c81b-73e3-48e1-a0d0-a5c6bae51e40" x="420" y="10" width="80" height="15" forecolor="#666666" fontName="Arial" fontSize="9.0" hTextAlign="Right">
			<expression><![CDATA["Página " + $V{PAGE_NUMBER} + " de"]]></expression>
		</element>
		<element kind="textField" uuid="03d1bc8d-46ed-4061-9c0f-02431eb52d22" x="500" y="10" width="55" height="15" forecolor="#666666" fontName="Arial" fontSize="9.0" evaluationTime="Report">
			<expression><![CDATA[" " + $V{PAGE_NUMBER}]]></expression>
		</element>
		<element kind="line" uuid="4a0061b8-55f2-4a6b-9613-fc7ff0563e32" x="0" y="5" width="555" height="1" forecolor="#CCCCCC"/>
	</pageFooter>
	<summary height="80" splitType="Stretch">
		<element kind="rectangle" uuid="08926283-97d5-408b-8f5c-d1b3f6a37cf2" mode="Opaque" x="0" y="10" width="555" height="60" backcolor="#E6F2FF">
			<pen lineWidth="1.0" lineColor="#3366CC"/>
		</element>
		<element kind="staticText" uuid="dd5efebe-3070-4c57-8667-8398f94f7801" x="20" y="20" width="150" height="20" forecolor="#003366" fontName="Arial" fontSize="11.0" bold="true" vTextAlign="Middle">
			<text><![CDATA[RESUMEN DEL REPORTE:]]></text>
		</element>
		<element kind="textField" uuid="760f59ee-d737-4d23-8938-b0781d2c11c3" x="20" y="42" width="200" height="20" forecolor="#003366" fontName="Arial" fontSize="10.0" bold="true" vTextAlign="Middle">
			<expression><![CDATA["Total Préstamos Activos: " + $V{total_prestamos}]]></expression>
		</element>
		<element kind="textField" uuid="bdeba4a0-c9b5-4f4c-bca8-acb820d4ea79" x="250" y="42" width="200" height="20" forecolor="#CC0000" fontName="Arial" fontSize="10.0" bold="true" vTextAlign="Middle">
			<expression><![CDATA["Préstamos Vencidos: " + $V{prestamos_vencidos}]]></expression>
		</element>
	</summary>
</jasperReport>
